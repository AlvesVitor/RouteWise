
# üöõ Sistema de An√°lise Fiscal com IA e Rotas

#### Este reposit√≥rio re√∫ne o projeto desenvolvido para o curso Agentes Aut√¥nomos com IA Generativa, oferecido pelas empresas I2A2, Meta e MetadataH.

Sistema inteligente para an√°lise automatizada de documentos fiscais (NF-e, CT-e, MDF-e) com c√°lculo de rotas otimizadas, geocodifica√ß√£o autom√°tica e an√°lise detalhada de custos log√≠sticos.

![Python](https://img.shields.io/badge/python-3.8+-blue.svg)
![Streamlit](https://img.shields.io/badge/streamlit-1.28+-red.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)

## üìã √çndice

- [Vis√£o Geral](#-vis√£o-geral)
- [Funcionalidades](#-funcionalidades)
- [Tecnologias Utilizadas](#Ô∏è-tecnologias-utilizadas)
- [Instala√ß√£o](#-instala√ß√£o)
- [Configura√ß√£o](#Ô∏è-configura√ß√£o)
- [Uso](#-uso)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [APIs Utilizadas](#-apis-utilizadas)
- [Exemplos de Uso](#-exemplos-de-uso)
- [Contribuindo](#-contribuindo)
- [Licen√ßa](#-licen√ßa)

## üéØ Vis√£o Geral

Este sistema foi desenvolvido para automatizar e otimizar o processo de an√°lise de documentos fiscais e planejamento log√≠stico. Ele combina intelig√™ncia artificial com APIs de geolocaliza√ß√£o e roteamento para fornecer:

- **Extra√ß√£o autom√°tica** de dados de XMLs fiscais brasileiros
- **Geocodifica√ß√£o inteligente** de endere√ßos de entrega
- **C√°lculo de rotas otimizadas** com dist√¢ncias e tempos
- **Estimativa precisa de custos** operacionais completos
- **Visualiza√ß√£o interativa** em mapas din√¢micos
- **Relat√≥rios export√°veis** para an√°lise e tomada de decis√£o

## ‚ú® Funcionalidades

### üìÑ Processamento de Documentos Fiscais

- ‚úÖ **NF-e (Nota Fiscal Eletr√¥nica)**: Extra√ß√£o completa de dados de produtos, valores e destinat√°rios
- ‚úÖ **CT-e (Conhecimento de Transporte Eletr√¥nico)**: Parse de informa√ß√µes de carga e transporte
- ‚úÖ **MDF-e (Manifesto de Documento Fiscal Eletr√¥nico)**: Processamento de manifestos de carga
- ‚úÖ **Valida√ß√£o autom√°tica** de XMLs com tratamento de namespaces
- ‚úÖ **Extra√ß√£o inteligente** de endere√ßos, CEPs e coordenadas

### üó∫Ô∏è Geocodifica√ß√£o e Rotas

- ‚úÖ **Geocodifica√ß√£o autom√°tica** usando OpenStreetMap/Nominatim (gratuito)
- ‚úÖ **Fallback inteligente** para endere√ßos incompletos (tenta cidade/estado)
- ‚úÖ **C√°lculo de rotas** com OpenRouteService API quando dispon√≠vel
- ‚úÖ **Estimativa de dist√¢ncias** usando f√≥rmula de Haversine como alternativa
- ‚úÖ **Otimiza√ß√£o de sequ√™ncia** de entregas para minimizar dist√¢ncia
- ‚úÖ **C√°lculo de tempo estimado** de viagem com base em velocidades m√©dias

### üí∞ An√°lise de Custos Completa

- ‚úÖ **Combust√≠vel**: C√°lculo baseado em consumo m√©dio e pre√ßo por litro
- ‚úÖ **Ped√°gios**: Estimativa por dist√¢ncia e n√∫mero de pra√ßas
- ‚úÖ **M√£o de obra**: Custo do motorista por hora trabalhada
- ‚úÖ **Desgaste do ve√≠culo**: Deprecia√ß√£o por quil√¥metro rodado
- ‚úÖ **Seguro e taxas**: Custos fixos di√°rios e por entrega
- ‚úÖ **Alimenta√ß√£o e pernoite**: Estimativas para viagens longas
- ‚úÖ **An√°lise de viabilidade**: Percentual do custo sobre valor da carga
- ‚úÖ **Recomenda√ß√µes inteligentes**: Sugest√µes autom√°ticas de otimiza√ß√£o

### üìä Visualiza√ß√£o e Relat√≥rios

- ‚úÖ **Mapa interativo** com Folium e marcadores coloridos
- ‚úÖ **Linhas de rota** com informa√ß√µes detalhadas em popups
- ‚úÖ **Dashboard completo** com m√©tricas principais
- ‚úÖ **Tabelas din√¢micas** com an√°lise de custos por categoria
- ‚úÖ **Gr√°ficos de viabilidade** econ√¥mica da opera√ß√£o
- ‚úÖ **Exporta√ß√£o em JSON** com todos os dados calculados
- ‚úÖ **Exporta√ß√£o em CSV** de documentos processados
- ‚úÖ **Interface responsiva** e intuitiva com Streamlit

## üõ†Ô∏è Tecnologias Utilizadas

### Core

- **Python 3.8+**: Linguagem principal do projeto
- **Streamlit 1.28+**: Framework para interface web interativa
- **OpenAI GPT** (opcional): Processamento de linguagem natural

### Processamento de Dados

- **xml.etree.ElementTree**: Parse nativo de XMLs fiscais
- **Pandas**: Manipula√ß√£o, an√°lise e visualiza√ß√£o de dados tabulares
- **dataclasses**: Estruturas de dados tipadas e imut√°veis
- **typing**: Type hints para c√≥digo mais robusto

### Geolocaliza√ß√£o e Mapas

- **Nominatim (OpenStreetMap)**: Geocodifica√ß√£o gratuita e sem API key
- **OpenRouteService**: C√°lculo de rotas otimizadas (opcional)
- **Folium**: Cria√ß√£o de mapas interativos com Leaflet.js
- **streamlit-folium**: Integra√ß√£o perfeita entre Folium e Streamlit

### Utilit√°rios

- **requests**: Requisi√ß√µes HTTP para APIs externas
- **python-dotenv**: Gerenciamento seguro de vari√°veis de ambiente
- **json**: Serializa√ß√£o e exporta√ß√£o de dados
- **datetime**: Manipula√ß√£o de datas e timestamps
- **math**: C√°lculos geogr√°ficos (Haversine, trigonometria)

## üì¶ Instala√ß√£o

### Pr√©-requisitos

- Python 3.8 ou superior instalado
- pip (gerenciador de pacotes Python)
- Conta OpenAI (opcional, apenas para recursos avan√ßados)

### Passo a Passo

1. **Clone o reposit√≥rio**

```bash
git clone https://github.com/AlvesVitor/RouteWise.git
cd RouteWise
```

2. **Crie um ambiente virtual (recomendado)**

```bash
python -m venv venv

# Linux/Mac
source venv/bin/activate

# Windows
venv\Scripts\activate
```

3. **Instale as depend√™ncias**

```bash
pip install -r requirements.txt
```

4. **Crie o arquivo requirements.txt** (se necess√°rio)

```txt
streamlit>=1.28.0
openai>=1.0.0
pandas>=2.0.0
folium>=0.14.0
streamlit-folium>=0.15.0
requests>=2.31.0
python-dotenv>=1.0.0
```

## ‚öôÔ∏è Configura√ß√£o

### 1. Vari√°veis de Ambiente

Crie um arquivo `.env` na raiz do projeto:

```env
# Obrigat√≥rio para recursos avan√ßados (pode funcionar sem)
OPENAI_API_KEY=sua_chave_openai_aqui
OPENAI_MODEL=gpt-4

# Opcional - Melhora precis√£o das rotas (gratuito at√© 2000 req/dia)
OPENROUTESERVICE_API_KEY=sua_chave_openroute_aqui

# Opcional - Ped√°gios precisos (pago)
TOLLGURU_API_KEY=sua_chave_tollguru_aqui
```

### 2. Obtenha as Chaves de API

#### OpenAI (Opcional)

- Acesse: https://platform.openai.com/api-keys
- Crie uma nova chave de API
- Cole no arquivo `.env`

#### OpenRouteService (Recomendado)

- Acesse: https://openrouteservice.org/dev/#/signup
- Cadastro gratuito (at√© 2000 requisi√ß√µes/dia)
- Cole a chave no arquivo `.env`

#### TollGuru (Opcional)

- Acesse: https://tollguru.com/
- Planos pagos para ped√°gios precisos
- Sistema funciona bem com estimativa interna

> **üí° Dica**: O sistema funciona sem as APIs opcionais, usando c√°lculos estimados e geocodifica√ß√£o gratuita do OpenStreetMap.

### 3. Arquivo .env.example

Crie um arquivo `.env.example` para refer√™ncia:

```env
OPENAI_API_KEY=your_openai_key_here
OPENAI_MODEL=gpt-4
OPENROUTESERVICE_API_KEY=your_openroute_key_here
TOLLGURU_API_KEY=your_tollguru_key_here
```

## üöÄ Uso

### Iniciar o Sistema

```bash
streamlit run app.py
```

O sistema abrir√° automaticamente no navegador em `http://localhost:8501`

### Fluxo de Trabalho Completo

#### 1Ô∏è‚É£ Upload de Documentos

- Clique no bot√£o de upload ou arraste os arquivos XML
- Formatos aceitos: `.xml` (NF-e, CT-e, MDF-e)
- Suporta m√∫ltiplos arquivos simultaneamente
- O sistema identifica automaticamente o tipo de documento

#### 2Ô∏è‚É£ Processamento Autom√°tico

O sistema extrai automaticamente:

- ‚úÖ Dados completos do destinat√°rio
- ‚úÖ Endere√ßos formatados (rua, n√∫mero, cidade, UF, CEP)
- ‚úÖ Valores totais das mercadorias
- ‚úÖ Pesos das cargas
- ‚úÖ Lista detalhada de produtos
- ‚úÖ Coordenadas geogr√°ficas (latitude/longitude)

#### 3Ô∏è‚É£ Configura√ß√£o da Rota

**Origem:**

- Digite o endere√ßo completo de onde a carga sair√°
- Exemplo: "Av. Paulista, 1000 - S√£o Paulo, SP"

**Par√¢metros do Ve√≠culo:**

- **Consumo m√©dio**: km por litro (ex: 3.5 km/l)
- **Pre√ßo do combust√≠vel**: valor atual por litro (ex: R$ 6,20)
- **Valor/hora motorista**: custo por hora (ex: R$ 15,00)

#### 4Ô∏è‚É£ C√°lculo e An√°lise

Clique em **"Calcular Rota e Custos"** e aguarde:

- üó∫Ô∏è Geocodifica√ß√£o da origem (2-5 segundos)
- üìç C√°lculo de rotas otimizadas (5-10 segundos)
- üí∞ An√°lise completa de custos (2-3 segundos)
- üó∫Ô∏è Gera√ß√£o do mapa interativo (3-5 segundos)

#### 5Ô∏è‚É£ Explorar Resultados

Navegue pelas abas:

**üìã Resumo Geral**

- M√©tricas principais (dist√¢ncia, tempo, custos)
- Informa√ß√µes da carga
- Consumo de combust√≠vel
- Recomenda√ß√µes inteligentes

**üó∫Ô∏è Mapa da Rota**

- Visualiza√ß√£o interativa com marcadores
- Popups com detalhes de cada parada
- Linhas coloridas indicando sequ√™ncia
- Zoom e navega√ß√£o livre

**üõ£Ô∏è Roteiriza√ß√£o**

- Tabela com sequ√™ncia otimizada
- Detalhes de cada trecho (dist√¢ncia, tempo, ped√°gios)
- Informa√ß√µes de entregas por parada

**üí∞ An√°lise de Custos**

- Decomposi√ß√£o por categoria
- Percentuais sobre o total
- An√°lise de viabilidade econ√¥mica
- Top 3 maiores custos

**üìà Dados Detalhados**

- Lista completa de documentos processados
- Estat√≠sticas por tipo e estado
- Exporta√ß√£o em JSON e CSV

#### 6Ô∏è‚É£ Exporta√ß√£o de Relat√≥rios

**Relat√≥rio Completo (JSON):**

- Todos os dados calculados
- Documentos processados
- Rotas detalhadas
- Custos discriminados
- Par√¢metros utilizados
- Timestamp da an√°lise

**Documentos (CSV):**

- Tabela simples para Excel
- Todos os campos dos XMLs
- Status de geocodifica√ß√£o
- Coordenadas calculadas

## üìù Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

```
MIT License

Copyright (c) 2025 Vitor Alves

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
...
```

### Pol√≠ticas de Dados

- ‚úÖ **Processamento local**: XMLs processados apenas na sua m√°quina
- ‚úÖ **Sem armazenamento**: Nenhum dado √© enviado para servidores externos
- ‚úÖ **APIs externas**: Apenas coordenadas s√£o enviadas (sem dados sens√≠veis)
- ‚úÖ **C√≥digo aberto**: Audite voc√™ mesmo o c√≥digo

</div>
